
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Guid") Тогда
		Guid = Параметры.Guid;
	КонецЕсли;
	
	Если Параметры.Свойство("ХозяйствующийСубъект") Тогда
		Объект.ХозяйствующийСубъект = Параметры.ХозяйствующийСубъект;
	КонецЕсли;
	
	Если Параметры.Свойство("ХС") Тогда
		Объект.ХозяйствующийСубъект = Параметры.ХС;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Guid) И НЕ ЗначениеЗаполнено(Объект.ХозяйствующийСубъект) Тогда
		Объект.ХозяйствующийСубъект = Ветис.Соответствие_ПолучитьСсылку(Guid, ВетисИмяСправочника.BusinessEntity("Справочник"));
		ЕстьСвязь = ЗначениеЗаполнено(Объект.ХозяйствующийСубъект);
	ИначеЕсли НЕ ЗначениеЗаполнено(Guid) И ЗначениеЗаполнено(Объект.ХозяйствующийСубъект) Тогда
		Guid = Ветис.Соответствие_ПолучитьGuid(Объект.ХозяйствующийСубъект);
		ЕстьСвязь = ЗначениеЗаполнено(Guid);
	Иначе
		ЕстьСвязь = Guid = Ветис.Соответствие_ПолучитьGuid(Объект.ХозяйствующийСубъект);
	КонецЕсли;
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
	КомандаНайтиПоGuidСервер();
	
	Если НЕ ЗначениеЗаполнено(Объект.ХозяйствующийСубъект) И ЗначениеЗаполнено(Наименование) Тогда
		Объект.ХозяйствующийСубъект = Справочники.Контрагенты.НайтиПоНаименованию(Наименование);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаГотово(Команда)
	
	Если ЕстьСвязь = Ложь Тогда
		ПоказатьВопрос(Новый ОписаниеОповещения("СоздатьСвязьОбработкаОповещения", ЭтаФорма), "Создать связь?", РежимДиалогаВопрос.ДаНетОтмена);
	Иначе
		Закрыть(Объект.ХозяйствующийСубъект);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьСвязьОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если пРезультат = КодВозвратаДиалога.Да Тогда
		
		ВетисВызовСервера.Соответствие_Добавить(Объект.ХозяйствующийСубъект, Guid, Наименование);
		
		Закрыть(Объект.ХозяйствующийСубъект);
		
	ИначеЕсли пРезультат = КодВозвратаДиалога.Нет Тогда
		
		Закрыть(Объект.ХозяйствующийСубъект);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаНайти(Команда)
	
	КомандаНайтиПоGuidСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаДобавить(Команда)
	
	_оо = Новый ОписаниеОповещения("КомандаДобавитьОбработкаОповещения", ЭтаФорма);
	
	_форма = ОткрытьФорму(ВетисИмяСправочника.BusinessEntity("Справочник", "ФормаОбъекта"),,,,,,_оо);
	
	ЗаполнитьЗначенияСвойств(_форма.Объект, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаДобавитьОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если НЕ пРезультат = Неопределено Тогда
		
		Объект.ХозяйствующийСубъект = пРезультат;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДекорацияЕстьСвязь1Нажатие(Элемент)
	
	ВетисВызовСервера.Соответствие_Удалить(Объект.ХозяйствующийСубъект);
	
	ЕстьСвязь = Ложь;
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры

&НаКлиенте
Процедура ДекорацияЕстьСвязь0Нажатие(Элемент)
	
	ВетисВызовСервера.Соответствие_Добавить(Объект.ХозяйствующийСубъект, Guid, Наименование);
	
	ЕстьСвязь = Истина;
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры


&НаКлиенте
Процедура GuidПриИзменении(Элемент)
	
	//Объект.ХозяйствующийСубъект = ВетисВызовСервера.Соответствие_ПолучитьСсылку(Guid, ВетисИмяСправочника.BusinessEntity("Справочник"));
	//
	//КомандаНайтиПоGuidСервер();
	
	ЕстьСвязь = Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(Объект.ХозяйствующийСубъект);
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры

&НаКлиенте
Процедура ХозяйствующийСубъектПриИзменении(Элемент)
	
	//Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(Объект.ХозяйствующийСубъект);
	//
	//КомандаНайтиПоGuidСервер();
	
	ЕстьСвязь = Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(Объект.ХозяйствующийСубъект);
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры


&НаСервере
Процедура КомандаНайтиПоGuidСервер()
	
	Если ЗначениеЗаполнено(Guid) Тогда
		
		_Версия20 = Ветис.Версия_2_0();
		
		_businessEntity = ?(_Версия20, ВетисEnterpriseService_2_0, ВетисEnterpriseService).GetBusinessEntityByGuid(Guid);
		
		Элементы.ГруппаПредупреждение.Видимость = _businessEntity = Неопределено;
		Элементы.ГруппаРеквизиты.Видимость = НЕ _businessEntity = Неопределено;
		
	КонецЕсли;
	
	Если НЕ _businessEntity = Неопределено Тогда
		Если _businessEntity.type = ВетисКонстанты.BusinessEntityType_JURIDICAL() Тогда
			Наименование = ?(_businessEntity.name = Неопределено, _businessEntity.fullName, _businessEntity.name);
		Иначе
			Наименование = _businessEntity.fio;
		КонецЕсли;
		
		Тип = ?(_Версия20, ВетисDictionaryСлой1с, ВетисCerberusEnterpriseСлой1с).BusinessEntityType(_businessEntity.type);
		
		ИНН = _businessEntity.inn;
		КПП = _businessEntity.kpp;
		
		Если НЕ _businessEntity.juridicalAddress = Неопределено Тогда
			Страна = ?(_Версия20, ВетисDictionaryСлой1с, ВетисIkarСлой1с).Country(_businessEntity.juridicalAddress.country);
			Регион = ?(_Версия20, ВетисDictionaryСлой1с, ВетисIkarСлой1с).Region(_businessEntity.juridicalAddress.region);
			Район = ?(_Версия20, ВетисDictionaryСлой1с, ВетисIkarСлой1с).District(_businessEntity.juridicalAddress.district);
			НаселенныйПункт = ?(_Версия20, ВетисDictionaryСлой1с, ВетисIkarСлой1с).Locality(_businessEntity.juridicalAddress.locality);
			АдресПредставление = _businessEntity.juridicalAddress.addressView;
		КонецЕсли;
	Иначе
		Наименование = "";
		Тип =  Неопределено;
		ИНН =  Неопределено;
		КПП =  Неопределено;
		Страна = Неопределено;
		Регион = Неопределено;
		Район = Неопределено;
		НаселенныйПункт = Неопределено;
		АдресПредставление = Неопределено;
	КонецЕсли;
	
КонецПроцедуры
